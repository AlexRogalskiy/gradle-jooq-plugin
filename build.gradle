import java.text.SimpleDateFormat

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        // of bintray plugin
        classpath "com.jfrog.bintray.gradle:gradle-bintray-plugin:$bintrayPluginVersion"
    }
}

apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'bintray'

repositories {
    jcenter()
}

dependencies {
    compile gradleApi()
    compile "org.codehaus.groovy:groovy-all:$groovyVersion"

    compile("org.jooq:jooq:$jooqVersion")
    compile("org.jooq:jooq-meta:$jooqVersion")
    compile("org.jooq:jooq-codegen:$jooqVersion")
}

group = 'nu.studer'
version = '1.0.1'

project.tasks.withType(Jar).all {
    from file('LICENSE')
    manifest {
        attributes 'Implementation-Title': 'Gradle jOOQ plugin',
                'Implementation-Version': version,
                'Implementation-Vendor': 'Etienne Studer',
                'Build-Date': new SimpleDateFormat("yyyy-MM-dd").format(new Date()),
                'Build-JDK': System.getProperty('java.version'),
                'Build-Gradle': gradle.gradleVersion,
                'Project-Url': 'https://github.com/etiennestuder/gradle-jooq-plugin'
    }
}

task jarSources(type: Jar) {
    description = 'Assembles a jar archive containing the main sources.'
    from sourceSets.main.allSource
    classifier = 'sources'
}

artifacts {
    archives jarSources
}

bintray {
    user = "$BINTRAY_USER"
    key = "$BINTRAY_API_KEY"

    configurations = ['archives']

    pkg {
        repo = 'gradle-plugins'
        name = 'nu.studer.jooq'
        desc = 'Gradle plugin that integrates jOOQ'
        licenses = ['Apache-2.0']
        labels = ['gradle', 'plugin']
    }

    dryRun = false
}

task wrapper(type: Wrapper) {
    gradleVersion = '1.12'
}
